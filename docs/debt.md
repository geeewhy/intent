# Debt Account

Live doc. It is a starting point for tracking and managing technical debt.

### Outstanding Technical Debt

| Cost                                         | Item                                         | Notes                                                                                                                                     | Considerations                                                                                                                                                                                                                   |
|----------------------------------------------|----------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Med**: operational visibility gap          | **No saga stuck-state or timeout observability**   | Sagas expire via TTL but lack metrics, span traceability, or alerts for missing signals or long waits.                                    | • Emit `saga.plan.waiting` and `saga.plan.failed` spans for key transitions.<br>• Consider timeout thresholds per signal type to detect dead workflows.<br>• Optionally emit a `saga.stuck` event after inactivity threshold.    |
| **Med**: operator debugging friction         | **Missing CLI support for event trace or replay**  | Replaying a single aggregate or tracing causation across events requires manual DB queries.                                               | • Add CLI tooling for: `replay <aggregateId>`, `trace <causationId>`, `simulate <command>`.<br>• Include optional `--dry-run` mode to inspect state without mutation.                                                            |
| **Med**: tenant lifecycle tooling missing    | **No tenant archival, export, or wipeout support** | All events live in shared tables; system lacks tools for per-tenant export, redaction, or offboarding.                                    | • Define a `dropTenant()` and `exportTenant()` CLI command.<br>• Index events by `tenant_id` at the DB level for efficient archival or replay.<br>• Document GDPR/data-retention strategies and safe offboarding steps.          |
| **Low**: ci exec overhead                    | **Merge github workflows**     | One workflow, use depends instead of cache layer                                                                                          | Github doesnt support workflows to depend on each other, OR have separate badges for tasks, switch to shields io when repo goes public                                                                                           |
| **Low**: projection migration fragility      | **No projection dual-write or version switch**     | Drift-repaired projections are overwritten in-place; system lacks support for `read_model_v2` cutovers or blue-green migration.           | • Introduce optional `versionedProjection(table: string, version: number)` helper.<br>• Allow dual-write during drift repair.<br>• Track active read model version per consumer for safe switchover.                             |
| **Low**: replay coverage not formalized      | **No test suite for saga plan determinism**        | Saga plan logic is pure but lacks deterministic replay tests mapping input → plan → command emission.                                     | • Add golden test files for input events/commands and expected emitted commands.<br>• Validate plan determinism and replay-safety across all registered sagas.<br>• Optionally snapshot test plan output for regression coverage. |
| **Low**: storage growth unchecked            | **No event store TTL or cold storage plan**        | Event log grows unbounded; no snapshot GC or archival plan defined.                                                                       | • Introduce snapshot GC policy: “keep last 3 per aggregate”.<br>• Add optional cold-storage export (e.g., write events to S3 for frozen tenants).<br>• Monitor row count and storage pressure as part of operational dashboard.  |
| **Low**: contained to tooling, easy refactor | **Projection registry missing**              | Glob searches in `repair-projection-drift.ts`, `check-projection-drift.ts`, `loadProjections.ts`, etc. leak projection knowledge into scripts. | • Central registry would remove brittle globbing.<br>• Refactor scripts incrementally; no production downtime expected.                                                                                                          |
| **Low**: wrappers already shield runtime     | **`aggregateId` vs `aggregate_id` mismatch** | Mixed casing in commands/events introduces typo risk and extra mapping code.                                                              | • Agree on single casing (prefer camelCase) and run codemod.<br>• Remove translation wrappers once cleaned.                                                                                                                      |
| **Low**: cosmetic, migration straightforward | **Schema & file naming inconsistencies**     | DB column `aggregate_id` vs code `aggregateId`; helper filenames not kebab-case.                                                          | • Rename column via online migration; update queries.<br>• Align filenames for grepability and convention.                                                                                                                       |
| **Low**: purely documentation                | **Outdated tooling docs**                    | `tools/README.md` no longer matches current scripts or flags.                                                                             | • Rewrite README with up-to-date commands and examples.<br>• Add doc-lint step to CI to catch future drift.                                                                                                                      |

# Paid
| Cost                              | Item                      | Notes                          |
|-----------------------------------|---------------------------|--------------------------------|
| **high**: separate infra schema   |                           |                                |
| **high**: snapshot can drift      | **Make snapshots atomic** | fold snapshot logic into append|
| **Med**: flat tool layout scales poorly      | **Tooling layout unstructured**              | All helper scripts live in a single `tools/` root.                                                                                             | • Introduce domain-based or feature subfolders (e.g., `tools/migrations`, `tools/projections`).<br>• Add a README per folder to explain purpose and usage.<br>• Move gradually—start with least-used scripts to minimise merge conflicts.<br>• Enforce structure via CI lint to prevent regressions. |
| **Med** | Central logging | Core lacks a mechanism to enable or standardize centralized logs. No infra hook exists to inject or bind a logging sink into core execution context.     | * Add `bindLogger()` port exposed by infra and injected at runtime.* Standardize log shape across sagas, activities, and commands.<br>  * Enforce structured logs with request context and correlation IDs.                       |
